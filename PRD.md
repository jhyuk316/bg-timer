# PRD: Board Game Timer

## 개요

보드게임 플레이 시 각 플레이어의 턴 시간을 관리하는 경량 웹앱.
GitHub Pages로 배포하며, 설치 없이 모바일/데스크톱 브라우저에서 바로 사용 가능.

## 기술 스택

| 항목 | 선택 | 이유 |
|------|------|------|
| 언어 | Vanilla JS (ES6+) | 의존성 제로, 빠른 로딩 |
| 스타일 | CSS (단일 파일) | 빌드 불필요 |
| 저장 | localStorage | 설정 영속화 |
| 배포 | GitHub Pages | 무료, 간편 |
| PWA | Service Worker + manifest.json | 오프라인 사용, 홈화면 추가 |

## 핵심 요구사항

### 1. 플레이어 설정
- 플레이어 수: 1~5명
- 각 플레이어 이름 설정 (기본값: "Player 1", "Player 2", ...)
- 각 플레이어 미플 색상을 10색 팔레트에서 개별 선택
- 설정값은 localStorage에 저장하여 다음 접속 시 복원

#### 미플 색상 팔레트 (10색)

> 채도를 낮춘 뮤트 톤. 프리셋 색상은 팔레트와 별도로 게임별 고유 색상 사용.

| # | 이름 | HEX |
|---|------|---------|
| 1 | Crimson | `#B84040` |
| 2 | Orange | `#CC7E3A` |
| 3 | Amber | `#C49645` |
| 4 | Green | `#4A9E6E` |
| 5 | Teal | `#4A9488` |
| 6 | Sky | `#6E9EB5` |
| 7 | Cobalt | `#3D6A9E` |
| 8 | Purple | `#7060A0` |
| 9 | Stone | `#9A857E` |
| 10 | Ivory | `#D8D4CF` |

기본 배정: Player 1~5 → Crimson, Cobalt, Amber, Green, Purple

#### 미플 색상 프리셋

**Ian O'Toole ** — 채도를 낮춘 세련된 톤. On Mars / Lisboa / Weather Machine 분위기.

| # | 이름 | HEX |
|---|------|---------|
| 1 | Powder Blue | `#7CAFC4` |
| 2 | Amber | `#D4A24E` |
| 3 | Dusty Rose | `#C4727A` |
| 4 | Teal | `#4E9E8E` |
| 5 | Soft Purple | `#8E7BB5` |
| 6 | Burnt Sienna | `#D47F52` |
| 7 | Sage | `#8BAF6E` |
| 8 | Warm Gray | `#A89088` |

**SETI** — 우주 기관 테마. 4인용.

| # | 이름 | HEX |
|---|------|---------|
| 1 | White | `#E8E4DF` |
| 2 | Green | `#4CAF7A` |
| 3 | Orange | `#E08840` |
| 4 | Purple | `#7B5EA7` |

**백로성 (The White Castle)** — 일본 전통 톤. 4인용.

| # | 이름 | HEX |
|---|------|---------|
| 1 | Red | `#C94040` |
| 2 | Blue | `#4477B0` |
| 3 | Yellow | `#D4B84E` |
| 4 | Green | `#5A9E64` |

**Endeavor Deep Sea** — 심해 탐사 테마. 5인용.

| # | 이름 | HEX |
|---|------|---------|
| 1 | Ivory | `#E8E4DF` |
| 2 | Mint | `#50C4A8` |
| 3 | Yellow | `#E0C850` |
| 4 | Purple | `#7B5EA7` |
| 5 | Red | `#C94040` |

### 2. 타이머 프리셋

단일 카운트다운 모드. 5개 프리셋 중 선택 후 세부값 수동 조정 가능.

| 프리셋 | 목표/인 | 턴 시간 | 예비시간 | 패널티 추가시간 |
|--------|--------|---------|---------|---------------|
| Filler | 15분 | 20초 | 5분 | 2분 |
| Light | 30분 | 30초 | 15분 | 3분 |
| Middle | 1시간 | 45초 | 30분 | 5분 |
| Heavy | 1.5시간 | 60초 | 50분 | 5분 |
| Epic | 2시간 | 90초 | 60분 | 10분 |

- **목표/인**: 1인당 예상 총 소요 시간 (약 30~40턴 기준)
- **턴 시간**: 매 턴 새로 부여되는 기본 시간
- **예비시간**: 플레이어별 총 예비시간 (턴 간 유지)
- **패널티 추가시간**: 예비시간 소진 시 패널티와 함께 부여되는 추가 시간

### 3. 타이머 동작

- 현재 턴 플레이어의 타이머만 진행 (동시에 두 개 이상의 타이머가 동작하지 않음)
- 일시정지 / 재개 기능
- 게임 리셋 기능
- 게임 종료 기능: 게임 종료 버튼 → 통계 화면으로 전환
- **백그라운드 동작**: 탭이 비활성화되어도 타이머 정확히 유지
  - `Date.now()` 기반 경과 시간 계산 (setInterval 드리프트 방지)
  - `visibilitychange` 이벤트로 복귀 시 시간 보정

#### 게임 상태 3종

- **플레이어 타이머 진행 중**: 특정 플레이어의 턴 타이머가 카운트다운 중
- **심판 타이머 진행 중**: 턴 사이 공백시간을 카운트업으로 측정 중
- **전체 정지**: 일시정지 상태 또는 게임 시작 전

#### 조작 규칙

| 현재 상태 | 동작 | 결과 |
|----------|------|------|
| 전체 정지 | 미플 A 탭 | A 타이머 시작 |
| A 진행 중 | 미플 A 탭 | A 정지 → 심판 타이머 시작 |
| A 진행 중 | 미플 B 탭 | A 정지 → B 즉시 시작 (직접 전환 숏컷) |
| 심판 진행 중 | 미플 B 탭 | 심판 정지 → B 타이머 시작 |
| 어떤 상태든 | 일시정지 버튼 | 전체 정지 |

- **게임 시작 상태**: 전체 정지. 아무 미플을 탭하면 해당 플레이어의 타이머가 시작된다.
- **직접 전환 숏컷**: A 진행 중 B를 탭하면 심판 타이머를 거치지 않고 B가 즉시 시작된다.

#### 심판 타이머

- 카운트업 방식 (턴 사이 공백시간 측정)
- 누적 심판 시간 기록
- 게임 종료 시 총 공백시간 확인 가능
- 상단 고정 바에 표시 (비활성 시 최소화, 활성 시 확장)

#### 턴 흐름

1. 턴 시작 → 턴 타이머 카운트다운
2. 턴 시간 소진 → 예비시간 카운트다운 진입 (시각적 전환)
3. 예비시간 소진 → **패널티 -2%** 적용 + 추가 예비시간 부여
4. 반복마다 패널티 누적 (-2%, -4%, -6%, ...)

#### 턴 넘기기 시

- 남은 턴 시간: 기본 소멸 (설정에서 "예비시간에 합산" 선택 가능)
- 예비시간: 유지
- 다음 턴에 새 턴 시간 부여

#### 패널티

- 점수 기반: **-2%** (게임별 점수 폭이 다르므로 비율 적용)
- 소진 횟수에 비례하여 누적
- 화면에 패널티 횟수 및 누적 감점 표시

### 4. 알림

- 턴 시간 → 예비시간 전환 시 경고 (색상 변화 + 선택적 소리)
- 예비시간 잔여 5분 시점에 TTS 음성 알림 (Web Speech API, 예: "5분 남았습니다")
- 예비시간 잔여 30% 시점에 추가 경고
- 예비시간 소진 시 패널티 알림 (화면 플래시 + 소리)
- 패널티 누적 횟수 상시 표시
- 소리 on/off 토글

### 5. UI/UX

#### 테마
- 단일 테마: 뉴트럴 다크 톤 (파란기 없는 다크 그레이 배경, 밝은 텍스트)
- 배경: `#232628` ~ `#1f2224` 계열
- 서피스: `#2a2d32` ~ `#34383e`
- 강조: 플레이어 색상 활용
- 텍스트: `#dcdcdc` / dim: `#808890`

#### 화면 구성
- **설정 화면**: 플레이어 수, 이름, 색상, 타이머 프리셋/세부값 설정
- **게임 화면**:
  - 화면을 플레이어 수만큼 등분 (각 영역 = 미플 + 이름 + 타이머 + 패널티)
  - 활성 플레이어: 색상 강조 + 타이머 크게 표시
  - 심판 타이머: 상단 고정 바 (비활성 시 최소화, 활성 시 확장)
  - 일시정지/리셋 버튼: 화면 가장자리 배치 (오조작 방지)
  - 레이아웃: 2인 상하 2등분 / 3인 상1+하2 / 4인 2×2 그리드 / 5인 상2+하3
- **통계 화면**: 게임 종료 후 결과 표시, 게임명 입력, 저장/새 게임 버튼
- **히스토리 화면**: 저장된 게임 목록, 선택 시 통계 상세 열람
- 화면 전환은 JS로 DOM 토글 (SPA 방식, 라우터 불필요)

#### 반응형
- 모바일 우선 설계 (보드게임은 테이블 위 스마트폰 사용이 주 시나리오)
- 데스크톱에서도 정상 동작

### 6. PWA
- `manifest.json`: 앱 이름, 아이콘, 테마 색상
- Service Worker: 오프라인 캐싱 (Cache First 전략)
- 홈 화면 추가 가능

### 7. 게임 통계 & 히스토리

#### 7-1. 통계 화면

게임 종료 시 표시되는 결과 화면.

**표시 항목:**

| 항목 | 설명 |
|------|------|
| 전체 플레이 타임 | 게임 시작~종료 총 경과 시간 |
| 플레이어별 총 소요 시간 | 각 플레이어 타이머 누적 합계 |
| 플레이어별 턴 수 | 각 플레이어가 활성화된 턴 횟수 |
| 플레이어별 패널티 | 패널티 횟수 및 누적 감점 |
| 심판 총 시간 | 심판 타이머 누적 합계 (공백시간) |
| 심판 턴 수 | 심판 타이머가 활성화된 횟수 |

**화면 구성:**
- 상단: 전체 플레이 타임
- 중앙: 플레이어별 통계 카드 (미플 색상 적용)
- 하단: 심판 통계 + 저장/새 게임 버튼

**동작:**
- 게임 종료 버튼 → 확인 다이얼로그 → 통계 화면 전환
- 통계 화면에서 게임명 입력 후 "저장" → 히스토리에 기록
- 게임명 입력 시 기존에 저장된 게임명 자동완성 제안 (같은 보드게임을 반복 플레이할 때 편의)
- "새 게임" 버튼 → 설정 화면으로 이동

#### 7-2. 히스토리

**저장 데이터 구조 (localStorage):**
- 게임명 (사용자 입력, 기본값: "Game - {날짜}")
- 날짜/시간
- 플레이어 목록 (이름, 색상)
- 타이머 프리셋/설정값
- 플레이어별 통계 (총 시간, 턴 수, 패널티)
- 심판 통계 (총 시간, 턴 수)
- 전체 플레이 타임

**히스토리 화면:**
- 설정 화면에서 접근 (히스토리 버튼)
- 저장된 게임 목록 (게임명, 날짜, 플레이어 수)
- 게임 선택 → 통계 상세 열람
- 삭제 기능

## 파일 구조

```
bg-timer/
├── index.html
├── css/
│   └── style.css
├── js/
│   ├── app.js          # 앱 초기화, 화면 전환
│   ├── timer.js        # 타이머 로직 (코어)
│   ├── settings.js     # 설정 관리, localStorage
│   ├── ui.js           # DOM 조작, 렌더링
│   ├── sound.js        # 알림 사운드 (Web Audio API)
│   └── history.js      # 히스토리 저장/조회, localStorage
├── manifest.json
├── sw.js               # Service Worker
├── icons/              # PWA 아이콘
└── PRD.md
```

## 설계 원칙

1. **빌드 없음**: HTML/CSS/JS 파일을 그대로 서빙
2. **의존성 제로**: 외부 라이브러리 없음
3. **모듈 분리**: 기능별 JS 파일 분리 (ES Modules)
4. **과하지 않게**: 필요한 기능만, 최소한의 추상화

## 참고: 보드게임 타이머 방식

| 방식 | 설명 | 대표 사례 |
|------|------|----------|
| Fischer increment | 턴마다 고정 시간 추가, 총 시간 내에서 운용 | 체스 |
| Byoyomi | 기본 시간 소진 후 짧은 추가시간을 무한 반복 | 바둑 |
| Scrabble 토너먼트 | 총 시간 초과 시 분당 점수 감점 | 스크래블 |
| BGA (Board Game Arena) | 플레이어별 총 시간 제한, 초과 시 강제 턴 넘김 | BGA 온라인 |

**본 프로젝트 타이머 = Fischer(턴 시간) + Scrabble(점수 패널티) + Byoyomi(무한 추가시간) 하이브리드**

- Fischer: 매 턴 새 턴 시간 부여
- Scrabble: 예비시간 초과 시 점수 비율(-2%) 패널티
- Byoyomi: 패널티 추가시간으로 게임이 강제 종료되지 않음

### 조작 방식 비교

| 조작 방식 | 설명 | 대표 사례 |
|----------|------|----------|
| 순차 전환 | 고정 순서 "다음" 버튼 | 체스 클럭, Board Game Timer |
| 자유 선택 | 아무 플레이어 탭 | Multi Player Chess Clock |
| 심판 타이머 | 턴 사이 공백시간 별도 추적 | Shared Game Timer (Admin Timer) |

**본 프로젝트 조작 방식 = 자유 선택 + 심판 타이머 + 직접 전환 숏컷**

- 자유 선택: 턴 순서가 유동적인 보드게임 특성에 맞춰 아무 플레이어나 탭으로 전환
- 심판 타이머: 턴 사이 토론·규칙 확인 등 공백시간을 별도 카운트업으로 추적
- 직접 전환 숏컷: A 진행 중 B 탭 시 심판 단계 없이 즉시 B 시작 (빠른 턴 전환)

## 향후 확장 가능 (현재 스코프 아님)

- 턴 순서 랜덤화
- 커스텀 효과음
- 다국어 지원
